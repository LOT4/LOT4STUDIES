---
title: "CONCEPTION - Level 3 checks: Vaccines exposure"
output: 
  html_document:
    theme: spacelab
    toc: true
    toc_float: true
    toc_depth: 3
    output_dir: output_dir
---

```{css,  echo = F}
/*-- Specify div's for 'boxes', change color of TOC and center align titles: --*/
div.box1 {background-color: #f5f5f0; border-radius: 5px; padding: 30px; margin-right: 0px}
div.box2 {border-style: solid; border-color: #f5f5f0; border-width: medium; border-radius: 30px; padding: 5px; margin-right: 0px}
div.box3 {border-style: solid; border-color: #f5f5f0; border-width: medium; border-radius: 30px; padding: 5px; margin-right: 0px}
div.box4 {border-style: solid; border-color: #f5f5f0; border-width: medium; border-radius: 30px; padding: 5px; margin-right: 0px}

.list-group-item.active, .list-group-item.active:focus, .list-group-item.active:hover {background-color: #76b82a; border-color: #76b82a}
h1 {text-align: center; color: #3c7b8a}
h2 {text-align: center; color: #76b82a}

/*-- Add logo (based on https://rstudio4edu.github.io/rstudio4edu-book/rmd-fancy.html): --*/
#TOC::before {content: ""; display: block; height: 60px; margin: 30px 10px 30px; background-image: url("conception_logo.png"); background-size: contain; background-position: center center; background-repeat: no-repeat}
```

```{r set_locale, include=FALSE}
Sys.setlocale("LC_ALL", "C")
`%!in%` = Negate(`%in%`)
```

<div class = 'box1'>

**Level 3:** Vaccines exposure in the study population and in females of childbearing age (12-55 years old)  

<br> 

The analysis contains the following steps:

<br>

![steps in analysis](vaccines_l3.png)

If subpopulations are available in your data the analysis will be performed separately for each subpopulation.
In case there is an overlapping subpopulation only subjects in the overlap period will be taken into account.
***Example:***

<br>

![subpopulations analysis](subpopulations.png)

`year` is retrieved from `vx_record_date` or `vx_admin_date`. If both dates are present, `vx_admin_date` will be used.

</div>

<br>

<div class = 'box2'>

## 1. Flowchart

```{r echo=F}
if (subpopulations_present=="No"){
flowchart<-fread(paste0(vacc_dir,"Masked/", "flowchart_masked.csv"))
datatable(flowchart, options = list(scrollX=T))
} else {
flowchart<-fread(paste0(vacc_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_flowchart_masked.csv"))
datatable(flowchart, options = list(scrollX=T))
}
```

</div>

<br>

<div class = 'box3'>

## 2. Description of vaccines_study_population

```{r echo=F}
if (subpopulations_present=="No"){
description<-fread(paste0(vacc_dir,"Masked/", "description_masked.csv"))
datatable(description, options = list(scrollX=T))
} else {
  description<-fread(paste0(vacc_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_description_masked.csv"))
datatable(description, options = list(scrollX=T))
}
```

</div>

<br>

<div class = 'box4'>

## 3. Counts in the study population

#### Number of records by ATC code, year and meaning

```{r echo=F}
if (subpopulations_present=="No"){
  if(sum(grepl(list.files(paste0(vacc_dir,"Masked/")), pattern="tab10_masked.csv"))>0){
tab10<-fread(paste0(vacc_dir,"Masked/", "tab10_masked.csv"))
if (tab10[,.N]>0){
setcolorder(tab10,c("atc_code_1", "count", "meaning", "year", "data_access_provider", "data_source"))
datatable(tab10, options = list(scrollX=T))
} else {
    print("This table cannot be produced based on the available data.")
}
  } else {
    print("This table cannot be produced based on the available data.")
}
} else {
    if(sum(grepl(list.files(paste0(vacc_dir,subpopulations_names[a], "/Masked/")), pattern="tab10_masked.csv"))>0){
  tab10<-fread(paste0(vacc_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_tab10_masked.csv"))
  if (tab10[,.N]>0){
  setcolorder(tab10,c("atc_code_1", "count", "meaning", "year", "data_access_provider", "data_source"))
datatable(tab10, options = list(scrollX=T))
  } else {
    print("This table cannot be produced based on the available data.")
}
    } else {
   print("This table cannot be produced based on the available data.")
    }
}
```

<br>

#### Number of records and users by ATC code, year and meaning

```{r echo=F}
if (subpopulations_present=="No"){
  if(sum(grepl(list.files(paste0(vacc_dir,"Masked/")), pattern="tab12_masked.csv"))>0){
tab12<-fread(paste0(vacc_dir,"Masked/", "tab12_masked.csv"))
if(tab12[,.N]>0){
setcolorder(tab12,c("atc_code_4", "no_records", "no_male_users", "median_rx_male_users", "no_female_users", "median_rx_female_users","meaning", "year", "atc_code_3","atc_code_1", "data_access_provider", "data_source"))
datatable(tab12, options = list(scrollX=T))
} else {
    print("This table cannot be produced based on the available data.")
}
  } else {
    print("This table cannot be produced based on the available data.")
}
} else {
    if(sum(grepl(list.files(paste0(vacc_dir,subpopulations_names[a], "/Masked/")), pattern="tab12_masked.csv"))>0){
  tab12<-fread(paste0(vacc_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_tab12_masked.csv"))
  if (tab12[,.N]>0){
  setcolorder(tab12,c("atc_code_4", "no_records", "no_male_users", "median_rx_male_users", "no_female_users", "median_rx_female_users","meaning", "year", "atc_code_3","atc_code_1", "data_access_provider", "data_source"))
datatable(tab12, options = list(scrollX=T))
  } else {
    print("This table cannot be produced based on the available data.")
}
    } else {
    print("This table cannot be produced based on the available data.")
    }
}
```

<br>

#### Number of records and users by ATC code, year and meaning

```{r echo=F}
if (subpopulations_present=="No"){
  if(sum(grepl(list.files(paste0(vacc_dir,"Masked/")), pattern="tab13_masked.csv"))>0){
tab13<-fread(paste0(vacc_dir,"Masked/", "tab13_masked.csv"))
if (tab13[,.N]>0){
datatable(tab13, options = list(scrollX=T))
setcolorder(tab13,c("atc_code_7", "no_records", "no_male_users", "median_rx_male_users", "no_female_users", "median_rx_female_users","meaning", "year", "atc_code_3", "data_access_provider", "data_source"))
} else {
    print("This table cannot be produced based on the available data.")
}
  } else {
   print("This table cannot be produced based on the available data.")
}
} else {
    if(sum(grepl(list.files(paste0(vacc_dir,subpopulations_names[a], "/Masked/")), pattern="tab13_masked.csv"))>0){
  tab13<-fread(paste0(vacc_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_tab13_masked.csv"))
  if(tab13[,.N]>0){
  setcolorder(tab13,c("atc_code_7", "no_records", "no_male_users", "median_rx_male_users", "no_female_users", "median_rx_female_users","meaning", "year", "atc_code_3", "data_access_provider", "data_source"))
datatable(tab13, options = list(scrollX=T))
  } else {
    print("This table cannot be produced based on the available data.")
}
    } else {
   print("This table cannot be produced based on the available data.")
    }
}
```

</div>

<br>

<div class = 'box5'>

## 4. Counts in females of childbearing age (12-55 years old)

#### Number of records by ATC code, meaning, year and age at start follow up 

```{r echo=F}
if (subpopulations_present=="No"){
  if(sum(grepl(list.files(paste0(vacc_dir,"Masked/")), pattern="tab11_masked.csv"))>0){
tab11<-fread(paste0(vacc_dir,"Masked/", "tab11_masked.csv"))
if(tab11[,.N]>0){
  setcolorder(tab11,c("atc_code_1", "count", "meaning", "year", "data_access_provider", "data_source"))
datatable(tab11, options = list(scrollX=T))
} else {
    print("This table cannot be produced based on the available data.")
}
  } else {
    print("This table cannot be produced based on the available data.")
}
} else {
    if(sum(grepl(list.files(paste0(vacc_dir,subpopulations_names[a], "/Masked/")), pattern="tab11_masked.csv"))>0){
  tab11<-fread(paste0(vacc_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_tab11_masked.csv"))
  if(tab11[,.N]>0){
    setcolorder(tab11,c("atc_code_1", "count", "meaning", "year", "data_access_provider", "data_source"))
datatable(tab11, options = list(scrollX=T))
  } else {
    print("This table cannot be produced based on the available data.")
}
    } else {
    print("This table cannot be produced based on the available data.")
    }
}
```

<br>

#### Number of records by ATC code, meaning, year and age at start follow up

```{r echo=F}
if (subpopulations_present=="No"){
  if(sum(grepl(list.files(paste0(vacc_dir,"Masked/")), pattern="tab14_masked.csv"))>0){
tab14<-fread(paste0(vacc_dir,"Masked/", "tab14_masked.csv"))
if(tab14[,.N]>0){
  setcolorder(tab14,c("atc_code_7", "no_records", "no_female_users", "median_rx_female_users","meaning", "year", "atc_code_3", "data_access_provider", "data_source"))
datatable(tab14, options = list(scrollX=T))
} else {
    print("This table cannot be produced based on the available data.")
}
  } else {
   print("This table cannot be produced based on the available data.")
}
} else {
    if(sum(grepl(list.files(paste0(vacc_dir,subpopulations_names[a], "/Masked/")), pattern="tab14_masked.csv"))>0){
  tab14<-fread(paste0(vacc_dir,subpopulations_names[a], "/Masked/", subpopulations_names[a],"_tab14_masked.csv"))
  if (tab14[,.N]>0){
    setcolorder(tab14,c("atc_code_7", "no_records", "no_female_users", "median_rx_female_users","meaning", "year", "atc_code_3", "data_access_provider", "data_source"))
datatable(tab14, options = list(scrollX=T))
  } else {
    print("This table cannot be produced based on the available data.")
}
    } else {
    print("This table cannot be produced based on the available data.")
    }
}
```

<br>

</div>

Author: Vjola Hoxhaj Drs.    
email: v.hoxhaj@umcutrecht.nl    
Organisation: UMC Utrecht, Utrecht, The Netherlands    

</div>

